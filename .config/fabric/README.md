# Fabric AI Helper Script

A robust shell script for interacting with `fabric-ai` patterns, generating content, and managing files within an Obsidian vault structure.

## 📋 Overview

This script provides an interactive command-line interface that simplifies the use of `fabric-ai` by offering a menu-driven experience for:

- Generating AI content using fabric patterns
- Managing input and output files
- Organizing content with proper YAML frontmatter for Obsidian

## 🚀 Features

- **Interactive Menu System**: User-friendly navigation with `gum` and `fzf`
- **AI Content Generation**: Seamless integration with fabric-ai patterns
- **File Management**: Browse, view, edit, and delete input/output files
- **Obsidian Integration**: Auto-generated YAML frontmatter for Obsidian vaults
- **Obsidian URI Support**: Opens files directly in Obsidian using proper URI scheme
- **Multi-format Support**: Open files in terminal, VS Code, or Obsidian
- **Safety Features**: Confirmation prompts for destructive operations
- **Error Handling**: Robust error checking and user feedback

## 📦 Dependencies

Before using the script, ensure you have the following tools installed:

1. **gum** - Interactive prompts and menus

   ```bash
   # Install via package manager or from GitHub
   # https://github.com/charmbracelet/gum
   ```

2. **fzf** - Fuzzy finder for file selection

   ```bash
   # Most distributions
   sudo apt install fzf  # Ubuntu/Debian
   brew install fzf      # macOS
   ```

3. **fabric-ai** - AI pattern framework

   ```bash
   # Install fabric-ai
   # https://github.com/danielmiessler/fabric
   go install github.com/danielmiessler/fabric@latest
   
   # Note: The script uses 'fabric-ai' directly for compatibility
   # Your interactive aliases from .fabric.zsh work in your shell sessions
   ```

## 🛠️ Installation

1. **Clone or download the script**:

   ```bash
   # The script is already in your fabric config directory
   /home/marcus/.config/fabric/fabric-ai-helper.sh
   ```

2. **Make it executable**:

   ```bash
   chmod +x /home/marcus/.config/fabric/fabric-ai-helper.sh
   ```

3. **Create an alias for easy access** (optional):

   ```bash
   echo 'alias fabric-helper="/home/marcus/.config/fabric/fabric-ai-helper.sh"' >> ~/.zshrc
   source ~/.zshrc
   ```

## 📁 Directory Structure

The script expects the following directory structure:

```
/home/marcus/notes/Vortex/99-Setup/Al Chat History/
├── _input/          # Input files (.md) for AI processing
└── *.md             # Output files generated by AI
```

If these directories don't exist, the script will offer to create them.

## 🔗 Obsidian Integration

### YAML Frontmatter

Each generated file includes YAML frontmatter optimized for Obsidian:

```yaml
---
title: Your Chosen Title
ai_agent: Gemini
ai_model: gemini-2.5-flash-preview-05-20
pattern: selected_pattern
language: en-US
creation_date: 2025-06-16
tags:
  - ai/prompt
---

[AI-generated content follows here]
```

### Obsidian URI Support

The script uses Obsidian's native URI scheme to open files directly in your vault:

- **Automatic vault detection**: Detects if files are within your Obsidian vault
- **Proper URI encoding**: Handles special characters and spaces in file paths
- **Direct file opening**: Opens files at the exact location in Obsidian
- **Background execution**: Opens Obsidian without blocking the terminal
- **Fallback support**: Uses standard file opening if not in vault

**URI Format**: `obsidian://open?vault=Vortex&file=99-Setup/Al%20Chat%20History/filename.md`

> **Note**: The script is configured for the "Vortex" vault. If you use a different vault name, edit the `vault_name` variable in the `open_in_obsidian()` function.

## 🎯 Usage

### Starting the Script

```bash
# Direct execution
/home/marcus/.config/fabric/fabric-ai-helper.sh

# Or if you set up an alias
fabric-helper
```

### Main Menu Options

1. **AI Helper** - Generate AI content
2. **List Inputs** - Browse and manage input files
3. **List Outputs** - Browse and manage output files  
4. **Exit** - Terminate the script

### AI Helper Workflow

1. **Select Input File**: Choose a `.md` file from the input directory
2. **Select Pattern**: Choose from available fabric-ai patterns
3. **Set Language**: Specify output language (default: en-US)
4. **Choose Filename**: Name your output file
5. **Generate Content**: AI processes your input and saves the result
6. **Post-Action**: View, edit, or open the generated file

### Generated File Format

Each generated file includes YAML frontmatter:

```yaml
---
title: Your Chosen Title
ai_agent: Gemini
ai_model: gemini-2.5-flash-preview-05-20
pattern: selected_pattern
language: en-US
creation_date: 2025-06-16
tags:
  - ai/prompt
---

[AI-generated content follows here]
```

> **Note**: The `ai_agent` and `ai_model` values are automatically loaded from your `~/.config/fabric/.env` file. The default language is also taken from your `LANGUAGE_OUTPUT` setting.

## 🧪 Testing

A comprehensive testing setup is provided:

### Quick Test Setup

```bash
# Run the test setup script
/home/marcus/.config/fabric/setup-test.sh
```

This creates a safe testing environment in `/tmp/fabric-test/` with:

- Sample input files
- Test script with modified paths
- Testing instructions

### Manual Testing

1. **Test Dependencies**:

   ```bash
   # Check if required tools are installed
   gum --version
   fzf --version
   fabric-ai --version   # The actual binary used by the script
   fabric --version      # Your alias (works in zsh sessions)
   ```

2. **Test Basic Functionality**:
   - Run the script and navigate through menus
   - Try selecting files with fzf
   - Test input validation

3. **Test AI Generation**:
   - Use sample input files (provided in your input directory)
   - Try different patterns (loaded from your patterns directory)
   - Verify output file format and YAML frontmatter

## 🔧 Customization

### Modify Default Directories

Edit the script to change default paths:

```bash
# In fabric-ai-helper.sh
readonly INPUT_DIR="your/custom/input/path"
readonly OUTPUT_DIR="your/custom/output/path"
```

### Change Default AI Settings

```bash
# In fabric-ai-helper.sh
readonly DEFAULT_AGENT="your-agent"
readonly DEFAULT_MODEL="your-model"
```

### Add Custom Patterns

The script automatically detects available fabric patterns using:

```bash
fabric --listpatterns
```

To add custom patterns, place them in your fabric patterns directory:

```bash
~/.config/fabric/patterns/your_custom_pattern/
```

### Pattern Aliases Integration

The script works seamlessly with pattern aliases you may have configured in `.fabric.zsh`. If you have pattern aliases set up (like in your configuration), they will be available through the fabric command used by the script.

Example pattern aliases from `.fabric.zsh`:

```bash
# Each pattern becomes a function that can generate content directly
# e.g., summarize "my-title" - saves to timestamped file
# e.g., summarize - streams output to terminal
```

## 🛡️ Safety Features

- **File Overwrite Protection**: Confirms before overwriting existing files
- **Input Validation**: Sanitizes filenames and validates inputs
- **Error Handling**: Graceful failure with informative messages
- **Dependency Checking**: Verifies required tools before execution
- **Confirmation Prompts**: Asks before destructive operations (file deletion)

## 🐛 Troubleshooting

### Common Issues

1. **Missing Dependencies**:
   - Install gum, fzf, and fabric as described above
   - Check PATH includes installation directories

2. **Directory Permissions**:

   ```bash
   # Fix permissions if needed
   chmod 755 /home/marcus/notes/Vortex/99-Setup/Al\ Chat\ History/
   chmod 755 /home/marcus/notes/Vortex/99-Setup/Al\ Chat\ History/_input/
   ```

3. **Fabric Pattern Issues**:

   ```bash
   # Update patterns (using your alias)
   fabric --updatepatterns
   
   # List available patterns
   fabric --listpatterns
   
   # If alias issues, use the full command:
   fabric-ai --listpatterns
   ```

4. **Script Execution Issues**:

   ```bash
   # Ensure script is executable
   chmod +x /home/marcus/.config/fabric/fabric-ai-helper.sh
   
   # Check for bash compatibility
   bash --version  # Should be 4.0+
   
   # If text viewer issues (less not found)
   # The script automatically detects available viewers: less, more, or cat
   ```

### Debug Mode

For detailed debugging, modify the script's first lines:

```bash
#!/bin/bash
set -euxo pipefail  # Add 'x' for debug output
```

## 📄 File Structure

```
/home/marcus/.config/fabric/
├── fabric-ai-helper.sh    # Main script
├── setup-test.sh          # Test environment setup
├── testing-plan.md        # Comprehensive testing plan
└── README.md              # This documentation
```

## 🤝 Contributing

To improve this script:

1. Test thoroughly using the provided testing framework
2. Follow shell scripting best practices
3. Maintain compatibility with existing fabric-ai patterns
4. Document any changes clearly

## 📚 Resources

- [Fabric AI Documentation](https://github.com/danielmiessler/fabric)
- [Gum Documentation](https://github.com/charmbracelet/gum)
- [FZF Documentation](https://github.com/junegunn/fzf)
- [Shell Scripting Best Practices](https://google.github.io/styleguide/shellguide.html)

## 📝 License

This script is provided as-is for educational and practical purposes. Follow the same license terms as the fabric-ai project.

---

**Author**: GitHub Copilot  
**Date**: June 16, 2025  
**Version**: 1.0.0
